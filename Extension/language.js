const translations = {
    "EXTENSION_NAME": {
        "en": "Consent-O-Matic",
        "da": "Consent-O-Matic",
        "de": "Consent-O-Matic"
    },
    "EXTENSION_SUBTITLE": {
        "en": "Your Choice - Applied Everywhere",
        "da": "Dit valg - Anvendt overalt"
    },
    "YOUR_CHOICE": {
        "en": "Your Choice",
        "da": "Dit valg"
    },
    "RULE_LIST": {
        "en": "Rule Lists",
        "da": "Regler"
    },
    "LOG": {
        "en": "Log",
        "da": "Log"
    },
    "DEBUG": {
        "en": "Debug",
        "da": "Debug"
    },
    "CHOICE_DESCRIPTION": {
        "en": "Configure what categories of tracking you would like to allow. Consent-O-Matic then fills out consent popups as best as possible based on your preferences. All tracking is rejected by default.",
        "da": "Konfigurer hvilke tracking kategorier du gerne vil tillade. Så vil Consent-O-Matic udfylde samtykke popups så godt den kan baseret på dine valg. Som standard bliver alt tracking afvist."
    },
    "RULES_DESCRIPTION": {
        "en": "Consent-O-Matic comes with a set of rules that tell it how to understand each kind of GDPR consent popup. You can add more sources of rules here - or even create your own list and share it with others!",
        "da": "Consent-O-Matic kommer med et sæt af regler der fortæller hvordan den skal behandler hver slags GDPR samtykke popup. Du kan tilføje flere regel kilder her - eller oprette din egen liste og dele den med andre!"
    },
    "ADD_LIST": {
        "en": "Add List",
        "da": "Tilføj liste"
    },
    "RULES_UPDATE_DESCRIPTION": {
        "en": "All the rule lists are updated automatically every 15 minutes or you can",
        "da": "Alle listerne med regler opdateres automatisk hvert 15. minut, eller du kan"
    },
    "UPDATE_RULES_NOW": {
        "en": "Update Rules Now",
        "da": "Opdater regler nu"
    },
    "RULE_GENERATOR": {
        "en": "Rule List Generator",
        "da": "Regel liste generator"
    },
    "RULE_GENERATOR_DESCRIPTION": {
        "en": "As an alternative to writing JSON rules by hand it is also possible to create rules using this drag-n-drop editor:",
        "da": "Som alternativ til at skrive JSON reglerne i hånden, er det også muligt at lave regler med denne drag-n-drop editor:"
    },
    "OPEN_RULE_GENERATOR": {
        "en": "Open Rule Editor",
        "da": "Åben regel editor"
    },
    "CLEAR": {
        "en": "Clear",
        "da": "Ryd"
    },
    "LOG_DESCRIPTION": {
        "en": "This is a list of all the GDPR consent popups that were handled",
        "da": "Dette er en liste over alle GDPR samtykke popups der har været håndteret"
    },
    "CLICK_DELAY_DESCRIPTION": {
        "en": "Wait a short time between performing each action or mouse gesture",
        "da": "Vent en kort periode i mellem udførslen af hver handling eller muse gesture"
    },
    "SKIP_SUBMIT_DESCRIPTION": {
        "en": "Perform actions normally but do not submit the consent",
        "da": "Udfør handlinger normalt, men lad være med at indsende samtykket"
    },
    "PAINT_MATCHERS_DESCRIPTION": {
        "en": "Visual feedback while matching consent choices",
        "da": "Visuel feedback mens samtykke valg matches"
    },
    "DEBUG_CLICKS_DESCRIPTION": {
        "en": "Debug clicks to the log",
        "da": "Debug klik til loggen"
    },
    "ALWAYS_FORCE_UPDATE_DESCRIPTION": {
        "en": "Always force a reload of the rules on each page load",
        "da": "Tving genlæsning af reglerne ved hver side hentning"
    },
    "SKIP_HIDE_DESCRIPTION": {
        "en": "Skips the HIDE_CMP method, to better see what's going on behind the scenes.",
        "da": "Spring HIDE_CMP metoden over, for bedre at se hvad der foregår bag kulisserne."
    },
    "EXTRA_DEBUG_DESCRIPTION": {
        "en": "Enables extra debug logging",
        "da": "Aktiver ekstra debug logning"
    },
    "INFORMATION_NAME": {
        "en": "Information Storage and Access"
    },
    "INFORMATION_DESCRIPTION": {
        "en": "Storage of information or access to information that is already stored on your device - such as advertising identifiers, device identifiers, cookies, and similar technologies."
    },
    "PREFERENCES_NAME": {
        "en": "Preferences and Functionality"
    },
    "PREFERENCES_DESCRIPTION": {
        "en": "Allow sites to remember choices you make (such as your user name, language or the region you are located in) and provide enhanced, more personal features. For instance, these cookies can be used to remember your login details, changes you have made to text size, fonts and other parts of web pages that you can customize. They may also be used to provide services you have asked for such as watching a video or commenting on a blog. The information in these cookies is not used to track your browsing activity on other websites."
    },
    "PERFORMANCE_NAME": {
        "en": "Performance and Analytics"
    },
    "PERFORMANCE_DESCRIPTION": {
        "en": "The collection of information, and combination with previously collected information, to measure, understand, and report, on your usage of the services. This allows websites to count visits and traffic sources so they can measure and improve the performance of the site. It helps them know which pages are the most and least popular, see how visitors move around the site, and where visitors come from."
    },
    "CONTENT_NAME": {
        "en": "Content selection, delivery, and reporting"
    },
    "CONTENT_DESCRIPTION": {
        "en": "Collection of information, and combination with previously collected information, to select and deliver content for you, and to measure the delivery and effectiveness of such content. This includes using previously collected information about your interests to select content, processing data about what <b>content</b> was shown, how often or how long it was shown, when and where it was shown, and whether you took any action related to the content, including for example clicking on content. The data will be used to personalise content on the website itself, but also in other contexts such as other websites, apps, browsers, and devices."
    },
    "AD_NAME": {
        "en": "Ad selection, delivery, and reporting"
    },
    "AD_DESCRIPTION": {
        "en": "Collection of information, and combination with previously collected information, to select and deliver advertisements, and to measure the delivery and effectiveness of such advertisements. This includes using previously collected information about your interests to select ads, processing data about what <b>advertisements</b> were shown, how often they were shown, when and where they were shown, and whether you took any action related to the advertisement, including for example clicking an ad or making a purchase. The data will be used to personalise advertising on the website itself, but also in other contexts such as other websites, apps, browsers, and devices.<br><br>Also includes:<br>Google"
    },
    "OTHER_NAME": {
        "en": "Other Purposes"
    },
    "OTHER_DESCRIPTION": {
        "en": "Unclassified data collection for which the purpose is not clearly described by the website or where the data collection and processing does not fit any other category"
    },
    "AUTOFILL_NOT_WORKING": {
        "en": "GDPR autofill didn't work?"
    },
    "LET_US_KNOW": {
        "en": "Let us know!"
    },
    "KEEP_RUNNING": {
        "en": "Keep running on this site?"
    },
    "MORE_ADDON_SETTINGS": {
        "en": "More Add-on Settings"
    }
};

class Language {
    static getString(key, subs) {
        //Find browser language
        let lang = navigator.language.substring(0, 2);

        //If no language, assume english
        if(lang == null) {
            lang = "en";
        }

        let result = "["+key+"-"+lang+"]";

        if(translations[key] != null) {
            const translation = translations[key];

            if(translation[lang] != null) {
                result = translation[lang];
            } else {
                console.warn("Missing translation ["+lang+"] for key: ", key, translation);
            }
        } else {
            console.warn("Unknown translation key:", key);
        }

        if(subs != null && Array.isArray(subs)) {
            for(let i = 1; i<subs.length+1; i++) {
                let sub = subs[i];
                result = result.replace("%"+i+"%", sub);
            }
        }

        return result;
    }

    static doLanguage() {
        window.addEventListener("DOMContentLoaded", ()=>{
            const allTextNodes = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);

            let regexp = /\[\[(\S+)\]\]/g;
    
            while(allTextNodes.nextNode()) {
                let matches = allTextNodes.currentNode.nodeValue.matchAll(regexp);
    
                for(let match of matches) {
                    let translation = Language.getString(match[1], []);
                    allTextNodes.currentNode.nodeValue = allTextNodes.currentNode.nodeValue.replace(match[0], translation);
                }
            }
        });
    }
}

Language.doLanguage();